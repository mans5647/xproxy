
# üõ∞Ô∏è XProxy

**XProxy** ‚Äî —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞–º–∏, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–º–∏ –Ω–∞ C. –û–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —É–¥–∞–ª—ë–Ω–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.  
–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ HTTP short-poll –∏ REST API. –°–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã, —Å–æ–±–∏—Ä–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –û–°, –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö, –ª–æ–≥–∞—Ö –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞—Ö, —Å–æ—Ö—Ä–∞–Ω—è—è –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ –∏ —É–ø—Ä–∞–≤–ª—è—è –æ—á–µ—Ä–µ–¥—è–º–∏ –∫–æ–º–∞–Ω–¥.

---

## ‚öôÔ∏è –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üì° –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ HTTP short-poll
- üñ• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞–º–∏:
  - –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –æ—á–µ—Ä–µ–¥–∏ shell-–∫–æ–º–∞–Ω–¥
  - –û–ø—Ä–æ—Å –∏ –≤—ã–¥–∞—á–∞ —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö –∫–æ–º–∞–Ω–¥ (—Å–∫—Ä–∏–Ω—à–æ—Ç—ã, –≤—ã–∫–ª—é—á–µ–Ω–∏–µ, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏ –¥—Ä.)
- üß† –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:
  - –°–æ—Å—Ç–æ—è–Ω–∏–µ –û–° (–∞–ø—Ç–∞–π–º, –ø–∞–º—è—Ç—å)
  - –ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
  - –°–∫—Ä–∏–Ω—à–æ—Ç—ã
  - –ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã–π –≤–≤–æ–¥
- üîÅ –û—á–µ—Ä–µ–¥–∏ –∫–æ–º–∞–Ω–¥ —Å –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π
- REST API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

---

## üß≠ REST API

### üéØ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|------|------------|
| `POST` | `/register_client` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ |
| `GET` | `/clients` | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ |
| `POST` | `/keep_alive` | –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∞–≥–µ–Ω—Ç–∞ |
| `POST` | `/disconnect` | –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –≤—Ä—É—á–Ω—É—é |

---

### üß© –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|------|------------|
| `POST` | `/update_computer/:client_id` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –û–° |
| `POST` | `/update_processes/:client_id` | –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∫–ª–∏–µ–Ω—Ç–∞ |
| `GET` | `/get_processes/:client_addr` | –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ |
| `GET` | `/get_osinfo/:client_addr` | –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ –æ–± –û–° |
| `POST` | `/post_screen` | –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ |
| `GET` | `/get_and_remove_screen/:client_addr` | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ |
| `POST` | `/post_kbdata` | –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–æ–≥–æ–≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã |
| `GET` | `/get_kbdata/:client_addr` | –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã |

---

### üß® –ö–æ–º–∞–Ω–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|------|------------|
| `POST` | `/add_command/:cmd_type/:client_addr` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª—è—é—â–µ–π –∫–æ–º–∞–Ω–¥—ã |
| `DELETE` | `/remove_command/:cmd_type/:client_addr` | –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã |
| `GET` | `/poll_about_command/:cmd_type` | –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–∏ –∫–æ–º–∞–Ω–¥ (–∫–ª–∏–µ–Ω—Ç) |
| `GET` | `/poll_status/:cmd_type/:client_addr` | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |
| `POST` | `/update_command/:cmd_type` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ |
| `HEAD` | `/check_failure/:cmd_type` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–±–æ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |

#### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã:

- `0` ‚Äî –í—ã–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
- `1` ‚Äî –°–Ω—è—Ç–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞
- `2` ‚Äî –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–≤–æ–¥–∞
- `3` ‚Äî –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

---

### üêö Shell-–æ—á–µ—Ä–µ–¥—å

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|------|------------|
| `POST` | `/shell/enque/:client_addr` | –ü–æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ –æ—á–µ—Ä–µ–¥—å |
| `POST` | `/shell/deque/:client_addr` | –£–¥–∞–ª–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é |
| `POST` | `/shell/update_head` | –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é |
| `GET` | `/shell/get_head_admin/:client_addr` | –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é (–∞–¥–º–∏–Ω) |
| `GET` | `/shell/get_head_client` | –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é (–∞–≥–µ–Ω—Ç) |
| `POST` | `/shell/clear/:client_addr` | –û—á–∏—Å—Ç–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –∫–ª–∏–µ–Ω—Ç–∞ |

---

## üóÉÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

- **Client**: ID, IP, –∏–º—è –º–∞—à–∏–Ω—ã, –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å
- **OSInfo**: –¥–æ—Å—Ç—É–ø–Ω–∞—è –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –ø–∞–º—è—Ç—å, –∞–ø—Ç–∞–π–º
- **Process**: PID, –∏–º—è, –ø—É—Ç—å, –≤–ª–∞–¥–µ–ª–µ—Ü, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- **Command**: —Ç–∏–ø –∫–æ–º–∞–Ω–¥—ã, —Å—Ç–∞—Ç—É—Å, stdout/stderr, –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞
- **ShellCommander**: –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –∫–æ–º–∞–Ω–¥ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Go 1.20+
- Gin Web Framework
- PostgreSQL / SQLite
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö (`sync.Map`, `container/list`)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ (Docker Compose)

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Docker –∏ Docker Compose
2. –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone https://github.com/mans5647/xproxy.git
cd xproxy
````

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç

```bash
docker-compose up --build
```

4. –°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
   [http://localhost:10013](http://localhost:10013)

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `docker-compose.yml`

```yaml
version: '3.8'

services:
  xproxy:
    build: .
    ports:
      - "10013:10013"
    depends_on:
      - db
    environment:
      - DB_HOST=db
      - DB_PORT=5432
      - DB_USER=postgres
      - DB_PASSWORD=postgres
      - DB_NAME=xproxy

  db:
    image: postgres:14
    restart: always
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: xproxy
    volumes:
      - pgdata:/var/lib/postgresql/data

volumes:
  pgdata:
```

---

## üìà –ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ

* –ó–∞—â–∏—Ç–∞ API —á–µ—Ä–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ —Ç–æ–∫–µ–Ω—ã
* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTPS –∏ client‚ÄëID –ø—Ä–æ–≤–µ—Ä–∫–∏
* –ú–µ—Ç—Ä–∏–∫–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Grafana/Prometheus
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ WebSocket –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã
---
